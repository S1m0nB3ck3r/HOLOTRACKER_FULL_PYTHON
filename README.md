# HoloTracker - Digital Holographic Particle Tracking

**Author:** Simon Becker (Université de Lorraine)  
**Contact:** simon.becker@univ-lorraine.fr | simbecker@gmail.com

## Overview

HoloTracker is a comprehensive software suite for analyzing digital holograms to track particles in 3D space. It consists of two main applications:

1. **HoloTracker Locate** - Analyzes hologram sequences to detect and localize particles in 3D
2. **HoloTracker Link** - Links particle detections across frames to generate continuous trajectories

## Features

### HoloTracker Locate
- Digital hologram reconstruction using Fourier Back-Propagation
- Multiple focus metrics (TENEGRAD, SUM_OF_LAPLACIAN, SUM_OF_VARIANCE, etc.)
- 3D particle detection and localization
- Batch processing of hologram sequences
- Interactive test mode for parameter optimization
- Real-time visualization of reconstruction planes
- Export results as CSV files

### HoloTracker Link
- Trajectory linking using Trackpy library
- Interactive 3D visualization of particle trajectories
- Configurable linking parameters (search range, memory, min length)
- Trajectory animation and playback
- Individual trajectory inspection
- Export linked trajectories as CSV files

## Requirements

- **Python 3.8 or higher**
- **Operating System:** Windows, Linux, or macOS
- **CUDA Toolkit** (for GPU acceleration with CuPy)
- **Compatible NVIDIA GPU** (recommended for faster processing)

### Required Python Packages
- numpy
- scipy
- matplotlib
- pandas
- opencv-python (cv2)
- Pillow (PIL)
- scikit-image
- ttkbootstrap
- trackpy
- cupy (for GPU-accelerated computing, requires CUDA)

**Note:** CuPy requires NVIDIA CUDA Toolkit to be installed. See [CuPy Installation Guide](https://docs.cupy.dev/en/stable/install.html) for details on matching CuPy version with your CUDA version.

## Installation

### 1. Clone or Download the Repository

```bash
git clone https://github.com/S1m0nB3ck3r/HOLOTRACKER_FULL_PYTHON.git
cd HOLOTRACKER_FULL_PYTHON
```

Or download and extract the ZIP file from GitHub.

### 2. Create a Virtual Environment (Recommended)

**On Windows (PowerShell):**
```powershell
python -m venv holotracker_env
.\holotracker_env\Scripts\Activate.ps1
```

**On Windows (Command Prompt):**
```cmd
python -m venv holotracker_env
holotracker_env\Scripts\activate.bat
```

**On Linux/macOS:**
```bash
python3 -m venv holotracker_env
source holotracker_env/bin/activate
```

### 3. Install Dependencies

With the virtual environment activated:

```bash
pip install -r requirements.txt
```

If `requirements.txt` is not present, install packages manually:

```bash
pip install numpy scipy matplotlib pandas opencv-python Pillow scikit-image ttkbootstrap trackpy
```

### 4. Install CuPy for GPU Acceleration (Optional but Recommended)

CuPy requires NVIDIA CUDA Toolkit. Install the appropriate version based on your CUDA installation:

**For CUDA 11.x:**
```bash
pip install cupy-cuda11x
```

**For CUDA 12.x:**
```bash
pip install cupy-cuda12x
```

**To check your CUDA version:**
```bash
nvcc --version
```

If you don't have a compatible NVIDIA GPU or CUDA installed, the software will fall back to CPU processing (slower but functional).

For more information, see the [CuPy Installation Guide](https://docs.cupy.dev/en/stable/install.html).

## Running the Applications

### HoloTracker Locate

**Purpose:** Detect and localize particles from hologram sequences

**Launch command:**

```bash
python code_locate/main_holotracker_locate.py
```

**Workflow:**
1. **PATH Tab:**
   - Select hologram directory (Browse button)
   - Select or compute mean hologram (optional but recommended)
   - Choose image type (BMP, TIF, JPG, PNG)

2. **PARAMETERS Tab:**
   - Configure hologram parameters (wavelength, pixel size, etc.)
   - Set propagation parameters (distance, number of planes, step)
   - Configure detection parameters (threshold, voxel limits)
   - Choose focus metric

3. **ACTIONS Tab:**
   - **Test Mode:** Analyze single hologram to optimize parameters
   - **Batch Processing:** Process entire hologram sequence
   - Results are saved as CSV files in the hologram directory

**Output:** CSV file with columns:
- HOLOGRAM NUMBER (frame index)
- OBJECT NUMBER (particle ID per frame)
- X POSITION (m)
- Y POSITION (m)
- Z POSITION (m)
- NUMBER OF VOXEL (particle size)

### HoloTracker Link

**Purpose:** Link particle detections across frames into continuous trajectories

**Launch command:**

```bash
python code_link/main_holotracker_link.py
```

**Workflow:**
1. **PATH Tab:**
   - Browse and select the CSV file generated by HoloTracker Locate

2. **ACTIONS Tab:**
   - Click "Open localisation File" to load particle data
   - Configure link parameters:
     - **Search Range (x, y, z):** Maximum particle displacement between frames
     - **Memory:** Number of frames a particle can be missing
     - **Min Length:** Minimum trajectory length to keep
   - Click "LINK" to perform trajectory linking
   - Use sliders to browse frames and trajectories
   - Click "Play" for trajectory animation
   - Click "SAVE TRAJECTORIES" to export results

**Output:** CSV file with original columns PLUS:
- TRAJECTORY NUMBER (unique ID for each linked trajectory)

## Typical Workflow

```
1. Acquire hologram sequence → 2. HoloTracker Locate → 3. HoloTracker Link → 4. Analysis
   (BMP/TIF images)              (Particle positions)      (Trajectories)       (External tools)
```

### Step-by-Step Example

**Step 1: Prepare your data**
- Hologram images in a directory (e.g., `Film REF/`)
- Images named sequentially (e.g., `image001.bmp`, `image002.bmp`, ...)

**Step 2: Run HoloTracker Locate**
```bash
python code_locate/main_holotracker_locate.py
```
- Select hologram directory
- Compute mean hologram (recommended)
- Test parameters on one hologram
- Run batch processing
- Output: `LOCALIZATIONS_YYYYMMDD_HHMMSS.csv`

**Step 3: Run HoloTracker Link**
```bash
python code_link/main_holotracker_link.py
```
- Load the localizations CSV file
- Adjust link parameters
- Click LINK
- Inspect trajectories
- Save results
- Output: `TRAJECTORIES_YYYYMMDD_HHMMSS.csv`

**Step 4: Analyze trajectories**
- Use Python, MATLAB, Excel, or other tools
- Calculate velocities, diffusion coefficients, etc.
- Generate publication-quality figures

## Parameter Guidelines

### HoloTracker Locate

**Wavelength:** Laser wavelength in meters (e.g., `532e-9` for 532 nm green laser)

**Pixel Size:** Physical size of camera pixel in meters (check camera specifications)

**Distance ini:** Starting reconstruction distance (typically 10-100 µm)

**Number of planes:** Depth resolution (e.g., 100-300 planes)

**Step:** Distance between planes (typically 0.5-2 µm)

**Threshold:** Detection sensitivity in standard deviations (typically 8-15)
- Lower values = more sensitive, more false positives
- Higher values = stricter, may miss particles

**Focus Metric:** Recommended options:
- **TENEGRAD:** Best general-purpose (gradient-based)
- **MEAN_LOG_ALL:** Robust combination of multiple metrics

### HoloTracker Link

**Search Range:** Based on particle velocity and frame rate
- Formula: `search_range ≈ max_velocity × time_between_frames × 1.5`
- Example: 10 µm/s particles, 10 fps → search_range = 10e-6 × 0.1 × 1.5 = 1.5e-6 m

**Memory:** Tolerance for missing detections
- Low-speed, dense particles: `memory = 2-5`
- High-speed, sparse particles: `memory = 0-2`

**Min Length:** Filter short trajectories
- Keep only well-tracked particles: `min_length = 10-20`
- Include all trajectories: `min_length = 3-5`

## Troubleshooting

### HoloTracker Locate

**Problem:** No particles detected
- **Solution:** Lower threshold, verify mean hologram, check image quality

**Problem:** Too many false detections
- **Solution:** Increase threshold, adjust min/max voxel limits, verify mean hologram subtraction

**Problem:** Slow processing
- **Solution:** Reduce number of planes, reduce image resolution, use faster focus metric

### HoloTracker Link

**Problem:** No trajectories found
- **Solution:** Increase search range, reduce min_length, verify input file format

**Problem:** Trajectories are fragmented
- **Solution:** Increase search range, increase memory parameter

**Problem:** Wrong particles linked together
- **Solution:** Reduce search range, verify particle density

## File Formats

### Input for HoloTracker Locate
- **Image formats:** BMP, TIF, JPG, PNG
- **Naming:** Sequential numbering (e.g., `image001.bmp`, `image002.bmp`)
- **Requirements:** All images same dimensions, same bit depth

### Output from HoloTracker Locate
```csv
HOLOGRAM NUMBER,OBJECT NUMBER,X POSITION (m),Y POSITION (m),Z POSITION (m),NUMBER OF VOXEL
1,1,0.000123,0.000456,0.000789,150
1,2,0.000234,0.000567,0.000890,200
```

### Output from HoloTracker Link
```csv
HOLOGRAM NUMBER,OBJECT NUMBER,X POSITION (m),Y POSITION (m),Z POSITION (m),NUMBER OF VOXEL,TRAJECTORY NUMBER
1,1,0.000123,0.000456,0.000789,150,0
1,2,0.000234,0.000567,0.000890,200,1
2,1,0.000125,0.000458,0.000791,148,0
2,2,0.000236,0.000569,0.000892,198,1
```

## GUI Features

### Common Features
- **Help Button:** Comprehensive user guide with step-by-step instructions
- **Modern UI:** Dark theme using ttkbootstrap
- **Auto-save:** Parameters automatically saved between sessions
- **Status Bar:** Real-time feedback on operations

### HoloTracker Locate Tabs
- **PATH:** File selection and mean hologram computation
- **PARAMETERS:** All analysis parameters organized by category
- **ACTIONS:** Display options, test mode, and batch processing controls
- **HOLOGRAM:** Reconstruction visualization
- **LOCALIZATIONS:** 3D scatter plot of detected particles
- **INFO:** Detailed table of particle properties

### HoloTracker Link Tabs
- **PATH:** Localisation file selection
- **ACTIONS:** Linking parameters and visualization controls
- **3D Plot:** Interactive trajectory visualization

## Performance Tips

1. **Use Test Mode** to optimize parameters before batch processing
2. **Compute mean hologram** for better background subtraction
3. **Start with small parameter ranges** and iterate
4. **Process smaller batches** for very large datasets
5. **Use faster focus metrics** (SUM_OF_INTENSITY) for initial tests
6. **Filter trajectories** after linking using min_length parameter

## Citation

If HoloTracker has been useful for your research, please cite:

**HoloTracker:** Developed by Simon Becker (Université de Lorraine)

## License

See [LICENSE](LICENSE) file for details.

## Contributing

For bug reports, feature requests, or contributions, please contact:
- simon.becker@univ-lorraine.fr
- simbecker@gmail.com

## Acknowledgments

- **Trackpy:** HoloTracker Link builds upon the excellent Trackpy library developed by the soft-matter community
- **ttkbootstrap:** Modern UI theme support
- **Scientific Python Stack:** NumPy, SciPy, Matplotlib, scikit-image

## Version History

- **Current:** Full Python implementation with GUI
- **Features:** Hologram reconstruction, particle detection, trajectory linking, interactive visualization

---

**Last Updated:** October 2025  
**Repository:** https://github.com/S1m0nB3ck3r/HOLOTRACKER
